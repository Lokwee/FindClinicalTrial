# FindClinicalTrials

Web app link: https://findclinicaltrial.herokuapp.com/

FindClinicalTrials is a program that enables users to search for currently available and recruiting clinical trials for Genetic Disorders chronicled on Clinvar (https://www.ncbi.nlm.nih.gov/clinvar/).
I first scraped https://www.ncbi.nlm.nih.gov/clinvar/ by searching for genetic disorders and saving the Conditions column. I then used that information to scrape for available clinical  trials in clinicaltrials.gov and save the information in a MySQL database. 
I used Heroku to deploy the app to the web -- free version.

## Files:
### clinvarClinical.py
In this file, I find genetic disorders from Clinvar. I then look for available clinical trials for each of the disorders and dynamically save this data to a MySQL database.

### connect.py
In this file, I create a MySQL database -- ClinicalTrials -- and make some changes to the GeneticDisorders table.

### app.py
With our database ready and populated, I use flask to create a web app where users can search for available clinical trials. 

### index.html
A file that defines our web app's home page.

### response.html
A file that designs the output of the search results.

### requirements.txt
A file required by Heroku in order to deploy your app.
Automatically generated by running below code
```
pip3 freeze > requirements.txt -- Python3
pip freeze > requirements.txt -- Python2
```

### Procfile
Required by Heroku and only requires one line of code
```
web: gunicorn app:myapp
```

## Lessons Learnt and Future Improvements
1. The web app still defaults to showing the first five clinical trials from our database. 
2. I first created a locally hosted MySQL database and found it difficult to use it to deploy the app -- probably a good thing because unlike Heroku, a locally hosted database would limit the availability of the web app.
3. I had to transfer my database from my local host to clearDB (heroku add-on that enables working with MySQL) -- Heroku is built and works using PostgreSQL. It would probably be easier to use PostgreSQL but I insisted on using MySQL.

#### Steps to transfer local MySQL Database to a ClearDB instance 

Using an example database with the following details, follow these steps to migrate a MySQL database to a remote server, in this case, Heroku's ClearDB
Hostname: localhost
Password: gold
username: root
Database name: example-db
- Export data using mysqldump by running below command on terminal:

```
mysqldump -u root -p --opt example-db > example-db.sql
```
The example-db.sql will now be available in your computer's home folder
- Given below sample Heroku database information, the next step is to add below line to the beginning of your .sql file
Hostname: heroku_host
Password: silver
username: golden
Database name: heroku_db

```
use `heroku_db`;
```
- Next, run this on command to move the .sql file to your app's cleardb instance 
mysql --host=heroku_host --user=golden --password=silver --reconnect heroku_db < example-db.sql
Remember to write the full path to example-db.sql

4. I did most of string editting manually since the list of condtions from Clinvar was not a clean dataset.
However, there are probably better and more efficient ways to do this by performing better string manipulations or improving our search in clinvar.

5. The search criteria could also use some improvement as it only shows exact conditions/ Names. I could improve this by having the search box suggest condition names for user's convenience.

6. Clinicaltrials.gove is dynamically populated using Javascript and Ajax. 
Furthermore, the url does not change with page changes. As such, I had to find create ways to perform pagination and used Selenium to interact with the website and click Next buttons.
Another challenge encountered was the fact that some of the elements especially, Next buttons (enabled vs disabled) shared most if not all identifiers including class, id and css selectors, even the autogenerated xpath. As such, I had to create my own xpaths to pin point specific elements and find ways to differentiate enabled vs disabled buttons. Below code shows one such maneuver:
```python
# Method that takes xpath and returns True if it exists
def check_exists_by_xpath(xpath):
  try:
    driver.find_element_by_xpath(xpath)
  except NoSuchElementException:
    return False
  return True

# I used below code to check whether we were at the last page and click next if we were not yet there
if check_exists_by_xpath("//a[@class='paginate_button next disabled']") == False and check_exists_by_xpath('//*[@id="theDataTable_next"]'):
      button = driver.find_element_by_xpath('//*[@id="theDataTable_next"]')
      button.click()
      pages =+ 1
      time.sleep(5)
    else:
      print('None available')
```
